<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Queue Manager</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #queueList { list-style: none; padding: 0; }
    li { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
    button { margin-top: 10px; }
  </style>
  <!-- Firebase libraries -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script>
    // Replace with your Firebase project configuration
    var firebaseConfig = {
    apiKey: "AIzaSyArhtko72Apx37wxCrg5ebTJTKPT2cldVE",
    authDomain: "linkqueue-c0ebd.firebaseapp.com",
    projectId: "linkqueue-c0ebd",
    storageBucket: "linkqueue-c0ebd.firebasestorage.app",
    messagingSenderId: "952645301250",
    appId: "1:952645301250:web:aa485153f1f0461612a31b",
    measurementId: "G-N6JG5FCSTE"
    };
    firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();
  </script>
</head>
<body>
  <h1>Queue Manager</h1>
  <ul id="queueList"></ul>
  <script>
    // Hardcoded manager password â€“ change as needed
    var managerPassword = "yourpassword";
    
    // Function to check if a valid login timestamp exists
    function isLoggedIn() {
      const loginTime = localStorage.getItem("managerLoginTime");
      if (!loginTime) return false;
      const loginTimestamp = parseInt(loginTime, 10);
      const now = Date.now();
      const oneDay = 24 * 60 * 60 * 1000; // 24 hours in milliseconds
      return (now - loginTimestamp < oneDay);
    }
    
    // Function to require login if not already logged in
    function requireLogin() {
      if (isLoggedIn()) {
        loadQueue();
      } else {
        const password = prompt("Enter manager password:");
        if (password === managerPassword) {
          // Store the current time as the login timestamp
          localStorage.setItem("managerLoginTime", Date.now().toString());
          loadQueue();
        } else {
          alert("Incorrect password!");
          window.location.href = "index.html";
        }
      }
    }
    
    // Call requireLogin on page load
    requireLogin();
    
    // Function to load and display the queue
    function loadQueue() {
      db.collection("queue")
        .where("played", "==", false)
        .orderBy("timestamp")
        .onSnapshot(
          function(querySnapshot) {
            var list = document.getElementById("queueList");
            list.innerHTML = "";
            if(querySnapshot.empty) {
              list.innerHTML = "<li>No items in the queue.</li>";
              return;
            }
            querySnapshot.forEach(function(doc) {
              var item = doc.data();
              var li = document.createElement("li");
              li.innerHTML = `<strong>${item.username}</strong> submitted: 
                              <a href="${item.link}" target="_blank">${item.link}</a><br>
                              <small>${item.timestamp ? item.timestamp.toDate().toLocaleString() : "Pending..."}</small>`;
              var btn = document.createElement("button");
              btn.textContent = "Mark as Played";
              btn.onclick = function() {
                db.collection("queue").doc(doc.id).update({ played: true })
                  .catch(function(error) {
                    console.error("Error updating document: ", error);
                  });
              };
              li.appendChild(btn);
              list.appendChild(li);
            });
          },
          function(error) {
            console.error("Error loading queue:", error);
            alert("Error loading queue. Check console for details.");
          }
        );
    }
  </script>
</body>
</html>
